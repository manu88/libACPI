/*
 * This file is part of the libACPI project
 * Copyright (c) 2018 Manuel Deneu.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, version 3.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

#include "DecompilerInvalid_Tests.h"
#include <AMLDecompiler.h>
#include <assert.h>



void DecompilerInvalid_Tests()
{
    {
        AMLDecompiler decomp;
        assert(AMLDecompilerInit(&decomp));
        AMLDecompilerUseDefaultCallbacks(&decomp);
        // This is a valid ACPI Buffer, but with the last part removed
        const uint8_t b[] = {0x44,0x53,0x44,0x54,0x96,0x00,0x00,0x00,
            0x28,0xa3,0x4f,0x45,0x4d,0x49,0x44,0x00,
            0x50,0x52,0x4f,0x55,0x54,0x00,0x00,0x00,
            0x34,0x12,0xcf,0xab,0x49,0x4e,0x54,0x4c,
            0x13,0x12,0x18,0x20,0x10,0x05,0x5f,0x53,
            0x42,0x5f,0x10,0x4b,0x06,0x5f,0x53,0x42,
            0x5f,0x5b,0x82,0x0f,0x50,0x43,0x49,0x30,
            0x08,0x5f,0x48,0x49,0x44,0x0c,0x41,0xd0,
            0x0a,0x03,0x5b,0x82,0x19,0x50,0x43,0x49,
            0x31,0x08,0x5f,0x48,0x49,0x44,0x0c,0x41,
            0xd0,0x0a,0x01,0x08,0x5f,0x41,0x44,0x52,
            0x0c,0xef,0xab,0x36,0x45};
        
        AMLParserError ret = AMLDecompilerStart(&decomp, b, sizeof(b));
        assert(ret == AMLParserError_BufferTooShort);
        assert(decomp.errorPos != NULL);
        
    }
}
