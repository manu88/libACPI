//
//  DecompilerInvalid_Tests.c
//  Tests
//
//  Created by Manuel Deneu on 17/01/2019.
//  Copyright Â© 2019 Manuel Deneu. All rights reserved.
//

#include "DecompilerInvalid_Tests.h"
#include <AMLDecompiler.h>
#include <assert.h>

void DecompilerInvalid_Tests()
{
    {
        AMLDecompiler decomp;
        assert(AMLDecompilerInit(&decomp));
        
        // This is a valid ACPI Buffer, but with the last part removed
        const uint8_t b[] = {0x44,0x53,0x44,0x54,0x96,0x00,0x00,0x00,
            0x28,0xa3,0x4f,0x45,0x4d,0x49,0x44,0x00,
            0x50,0x52,0x4f,0x55,0x54,0x00,0x00,0x00,
            0x34,0x12,0xcf,0xab,0x49,0x4e,0x54,0x4c,
            0x13,0x12,0x18,0x20,0x10,0x05,0x5f,0x53,
            0x42,0x5f,0x10,0x4b,0x06,0x5f,0x53,0x42,
            0x5f,0x5b,0x82,0x0f,0x50,0x43,0x49,0x30,
            0x08,0x5f,0x48,0x49,0x44,0x0c,0x41,0xd0,
            0x0a,0x03,0x5b,0x82,0x19,0x50,0x43,0x49,
            0x31,0x08,0x5f,0x48,0x49,0x44,0x0c,0x41,
            0xd0,0x0a,0x01,0x08,0x5f,0x41,0x44,0x52,
            0x0c,0xef,0xab,0x36,0x45};
        
        AMLParserError ret = AMLDecompilerStart(&decomp, b, sizeof(b));
        assert(ret == AMLParserError_BufferTooShort);
        assert(decomp.errorPos != NULL);
        
    }
}
